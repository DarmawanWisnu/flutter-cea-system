@startuml
scale 6
skinparam monochrome true
skinparam defaultFontSize 20
title Activity Diagram - Monitor

|User|
start
:Akses halaman Monitor Screen;

|Sistem|
:Inisialisasi koneksi MQTT;
:Subscribe ke topic "kit/+/telemetry";
:Subscribe ke topic "kit/+/status";
:Load auto mode state dari Backend API;
:GET /device/mode?userId={userId}&deviceId={kitId};
:Menampilkan nilai sensor real-time;
:(pH, PPM, Temperature, Humidity, Water Level, Water Temp);
:Menampilkan status Kit dan mode kontrol (Auto / Manual);

|User|
:Melihat data sensor pada dashboard;
:Memilih mode kontrol (Auto / Manual);

|Sistem|
:Simpan preferensi mode ke Backend API;
:POST /device/mode;

if ("Mode Manual dipilih?") then (Ya)
  |Sistem|
  :Menampilkan tombol kontrol manual;
  :(pH Up, pH Down, Nutrient Add, Refill);

  |User|
  if ("User menekan tombol kontrol?") then (Ya)
    |Sistem|
    :Call API POST /actuator/event?deviceId={kitId};
    :Mendapat response duration dari Backend;
    :Publish perintah ke MQTT Broker;
    :Topic: "kit/{kitId}/control";
    :Update tampilan status aktuator;
  endif
else (Tidak - Mode Auto)
  |Sistem|
  :Backend menjalankan kontrol otomatis;
  :Berdasarkan threshold setiap 30 detik;
  :Notifikasi dibuat oleh Backend;
endif

|Sistem|
:Memperbarui status sensor secara real-time;
:Data dari MQTT stream;

stop
@enduml
